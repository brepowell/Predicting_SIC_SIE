INFO:root:Found 2100 NetCDF files:
INFO:root:Mask size: 53973
INFO:root:=== Extracting raw data and times in a single loop === 
INFO:root:Parsed 63875 total dates
INFO:root:First few: ['1850-01-01T00:30:00' '1850-01-02T00:00:00' '1850-01-03T00:00:00'
 '1850-01-04T00:00:00' '1850-01-05T00:00:00']
INFO:root:Total days collected: 63875
INFO:root:Unique days: 63875
INFO:root:First 35 days: ['1850-01-01T00:30:00' '1850-01-02T00:00:00' '1850-01-03T00:00:00'
 '1850-01-04T00:00:00' '1850-01-05T00:00:00' '1850-01-06T00:00:00'
 '1850-01-07T00:00:00' '1850-01-08T00:00:00' '1850-01-09T00:00:00'
 '1850-01-10T00:00:00' '1850-01-11T00:00:00' '1850-01-12T00:00:00'
 '1850-01-13T00:00:00' '1850-01-14T00:00:00' '1850-01-15T00:00:00'
 '1850-01-16T00:00:00' '1850-01-17T00:00:00' '1850-01-18T00:00:00'
 '1850-01-19T00:00:00' '1850-01-20T00:00:00' '1850-01-21T00:00:00'
 '1850-01-22T00:00:00' '1850-01-23T00:00:00' '1850-01-24T00:00:00'
 '1850-01-25T00:00:00' '1850-01-26T00:00:00' '1850-01-27T00:00:00'
 '1850-01-28T00:00:00' '1850-01-29T00:00:00' '1850-01-30T00:00:00'
 '1850-01-31T00:00:00' '1850-02-01T00:00:00' '1850-02-02T00:00:00'
 '1850-02-03T00:00:00' '1850-02-04T00:00:00']
INFO:root:Last 35 days: ['2024-11-27T00:00:00' '2024-11-28T00:00:00' '2024-11-29T00:00:00'
 '2024-11-30T00:00:00' '2024-12-01T00:00:00' '2024-12-02T00:00:00'
 '2024-12-03T00:00:00' '2024-12-04T00:00:00' '2024-12-05T00:00:00'
 '2024-12-06T00:00:00' '2024-12-07T00:00:00' '2024-12-08T00:00:00'
 '2024-12-09T00:00:00' '2024-12-10T00:00:00' '2024-12-11T00:00:00'
 '2024-12-12T00:00:00' '2024-12-13T00:00:00' '2024-12-14T00:00:00'
 '2024-12-15T00:00:00' '2024-12-16T00:00:00' '2024-12-17T00:00:00'
 '2024-12-18T00:00:00' '2024-12-19T00:00:00' '2024-12-20T00:00:00'
 '2024-12-21T00:00:00' '2024-12-22T00:00:00' '2024-12-23T00:00:00'
 '2024-12-24T00:00:00' '2024-12-25T00:00:00' '2024-12-26T00:00:00'
 '2024-12-27T00:00:00' '2024-12-28T00:00:00' '2024-12-29T00:00:00'
 '2024-12-30T00:00:00' '2024-12-31T00:00:00']
INFO:root:Shape of combined ice_area array: (63875, 53973)
INFO:root:Elapsed time for combined data/time loading: 1453.2193489074707 seconds
INFO:root:=== Calculating Freeboard === 
INFO:root:Elapsed time for freeboard calculation: 1526.017235994339 seconds
INFO:root:=== Patchifying === 
INFO:root:Elapsed time for patchifying with the latlon_spillover algorithm: 1527.3981430530548 seconds
INFO:root:=== Plotting Outliers and Imbalance === 
INFO:root:--- Checking for Freeboard Outliers ---
INFO:root:Data Shape is (63875, 53973)
INFO:root:Freeboard samples total 53973
INFO:root:Freeboard Absolute Minimum Value (pre-norm): 0.0000
INFO:root:Freeboard Absolute Maximum Value (pre-norm): 8.4384
INFO:root:Date of Absolute Minimum (0.0000): 1850-01-01 00:30:00 (Cell index in masked data: 0)
INFO:root:Date of Absolute Maximum (8.4384): 1948-04-12 00:00:00 (Cell index in masked data: 15128)
INFO:root:Percentage of Freeboard values exactly 0: 4018904.82% (2169123499 points)
INFO:root:pre-norm
INFO:root:Freeboard Q1: 0.0000
INFO:root:Freeboard Q3: 0.1580
INFO:root:Freeboard IQR: 0.1580
INFO:root:Freeboard Lower Bound (Q1 - 1.5*IQR): -0.2370
INFO:root:Freeboard Upper Bound (Q3 + 1.5*IQR): 0.3949
INFO:root:Number of low outliers: 0
INFO:root:Number of high outliers: 209360138
INFO:root:Total outliers: 209360138 (387897.91% of total elements)
WARNING:root:Potential outliers detected in Freeboard data!
INFO:root:Sample low outliers (first 10): []
INFO:root:Sample high outliers (first 10): [0.40869147 0.49997997 0.5575849  0.62369716 0.6355783  0.6142452
 0.5913012  0.53867054 0.47365034 0.53575784]
INFO:root:Sample high outliers (last 10): [0.40869147 0.49997997 0.5575849  ... 0.4113677  0.44109493 0.5085366 ]
INFO:root:--- Plotting Freeboard Distribution (prod_fb_pre_norm) ---
INFO:root:Freeboard distribution plot saved to: /pscratch/sd/b/brelypo/Predicting_SIC_SIE/prod_fb_pre_norm_20250728_123908.png
INFO:root:--- Analyzing Ice Area Imbalance ---
INFO:root:Total Ice Area data points: 3447525375
INFO:root:Percentage of values == 0: 60.41% (2082535065 points)
INFO:root:Percentage of values == 1: 0.03% (1001350 points)
INFO:root:Percentage of values between 0 and 1 (exclusive): 39.56% (1363988960 points)
INFO:root:--- Plotting Ice Area Imbalance Chart ---
INFO:root:Ice Area imbalance chart saved to: /pscratch/sd/b/brelypo/Predicting_SIC_SIE/prod_SIC_imbalance_20250728_124004.png
INFO:root:=== Normalizing Freeboard === 
INFO:root:Freeboard min (pre-norm): 0.0 meters
INFO:root:Freeboard max (pre-norm): 8.43836784362793 meters
INFO:root:Freeboard Shape: (63875, 53973)
INFO:root:Ice Area Shape:  (63875, 53973)
INFO:root:=== Normalized Freeboard ===
INFO:root:Freeboard min (post-norm): 0.0
INFO:root:Freeboard max (post-norm): 1.0
INFO:root:--- Checking for Freeboard Outliers ---
INFO:root:Data Shape is (63875, 53973)
INFO:root:Freeboard samples total 53973
INFO:root:Freeboard Absolute Minimum Value (post-norm): 0.0000
INFO:root:Freeboard Absolute Maximum Value (post-norm): 1.0000
INFO:root:Date of Absolute Minimum (0.0000): 1850-01-01 00:30:00 (Cell index in masked data: 0)
INFO:root:Date of Absolute Maximum (1.0000): 1948-04-12 00:00:00 (Cell index in masked data: 15128)
INFO:root:Percentage of Freeboard values exactly 0: 4018904.82% (2169123499 points)
INFO:root:post-norm
INFO:root:Freeboard Q1: 0.0000
INFO:root:Freeboard Q3: 0.0187
INFO:root:Freeboard IQR: 0.0187
INFO:root:Freeboard Lower Bound (Q1 - 1.5*IQR): -0.0281
INFO:root:Freeboard Upper Bound (Q3 + 1.5*IQR): 0.0468
INFO:root:Number of low outliers: 0
INFO:root:Number of high outliers: 209360207
INFO:root:Total outliers: 209360207 (387898.04% of total elements)
WARNING:root:Potential outliers detected in Freeboard data!
INFO:root:Sample low outliers (first 10): []
INFO:root:Sample high outliers (first 10): [0.04843253 0.05925079 0.06607734 0.07391206 0.07532005 0.07279194
 0.07007293 0.06383587 0.05613056 0.0634907 ]
INFO:root:Sample high outliers (last 10): [0.04843253 0.05925079 0.06607734 ... 0.04874968 0.05227254 0.0602648 ]
INFO:root:--- Plotting Freeboard Distribution (prod_fb_post_norm) ---
INFO:root:Freeboard distribution plot saved to: /pscratch/sd/b/brelypo/Predicting_SIC_SIE/prod_fb_post_norm_20250728_124235.png
INFO:root:End of __init__
INFO:root:Elapsed time for __init__: 2976.3838036060333 seconds
INFO:root:Training set start date: 1850-01-01T00:30:00
INFO:root:Training set end date: 2011-12-31T00:00:00
INFO:root:Validation set start date: 2012-01-01T00:00:00
INFO:root:Validation set end date: 2017-12-31T00:00:00
INFO:root:Testing set start date: 2018-01-01T00:00:00
INFO:root:Testing set end date: 2024-12-31T00:00:00
INFO:root:
--- Model Architecture ---
INFO:root:IceForecastTransformer(
  (patch_embed): Linear(in_features=512, out_features=128, bias=True)
  (encoder): TransformerEncoder(
    (layers): ModuleList(
      (0-3): 4 x TransformerEncoderLayer(
        (self_attn): MultiheadAttention(
          (out_proj): NonDynamicallyQuantizableLinear(in_features=128, out_features=128, bias=True)
        )
        (linear1): Linear(in_features=128, out_features=2048, bias=True)
        (dropout): Dropout(p=0.1, inplace=False)
        (linear2): Linear(in_features=2048, out_features=128, bias=True)
        (norm1): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
        (norm2): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
        (dropout1): Dropout(p=0.1, inplace=False)
        (dropout2): Dropout(p=0.1, inplace=False)
      )
    )
  )
  (mlp_head): Sequential(
    (0): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    (1): Linear(in_features=128, out_features=768, bias=True)
  )
)
INFO:root:Total model parameters: 2537088
INFO:root:--------------------------

INFO:root:== TIMER IS STARTING FOR TRAINING ==
INFO:root:===============================
INFO:root:       STARTING EPOCHS       
INFO:root:===============================
INFO:root:Number of epochs: 10
INFO:root:Learning Rate: 0.0001
INFO:root:Epoch 1/10 - Train Loss: 0.0568
INFO:root:Epoch 1/10 - Validation Loss: 0.0330
INFO:root:Epoch 2/10 - Train Loss: 0.0254
INFO:root:Epoch 2/10 - Validation Loss: 0.0194
INFO:root:Epoch 3/10 - Train Loss: 0.0174
INFO:root:Epoch 3/10 - Validation Loss: 0.0153
INFO:root:Epoch 4/10 - Train Loss: 0.0142
INFO:root:Epoch 4/10 - Validation Loss: 0.0134
INFO:root:Epoch 5/10 - Train Loss: 0.0127
INFO:root:Epoch 5/10 - Validation Loss: 0.0130
INFO:root:Epoch 6/10 - Train Loss: 0.0117
INFO:root:Epoch 6/10 - Validation Loss: 0.0116
INFO:root:Epoch 7/10 - Train Loss: 0.0113
INFO:root:Epoch 7/10 - Validation Loss: 0.0118
INFO:root:Epoch 8/10 - Train Loss: 0.0110
INFO:root:Epoch 8/10 - Validation Loss: 0.0114
INFO:root:Epoch 9/10 - Train Loss: 0.0108
INFO:root:Epoch 9/10 - Validation Loss: 0.0108
INFO:root:Epoch 10/10 - Train Loss: 0.0107
INFO:root:Epoch 10/10 - Validation Loss: 0.0104
INFO:root:===============================================
INFO:root:Elapsed time for TRAINING: 3630.39 seconds
INFO:root:===============================================
ERROR:ipykernel.comm:No such comm target registered: jupyter.widget.control
WARNING:Comm:No such comm: 2003df2e-f7fc-4ca9-8619-2df162c21257
